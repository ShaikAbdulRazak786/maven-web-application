pipeline {
    agent any

    tools {
        // Install the Maven version configured as "maven 3.8" and add it to the path.
        maven "maven 3.8.4"
    }

    stages {
        stage('scm') {
            steps {
                // Get some code from a GitHub repository
                git branch: 'master', credentialsId: 'git-credentials', url: 'https://github.com/ShaikAbdulRazak786/maven-web-application.git'
            }
        }
        stage('Clean') {
             steps {
                // Run Maven on a Unix agent.
                sh "mvn -Dmaven.test.failure.ignore=true clean"
            }
        }
        stage('Package') {
             steps {
                // Run Maven on a Unix agent.
                sh "mvn -Dmaven.test.failure.ignore=true package"
				
            }
        }
        
        stage('Artifact') {
            steps {
                // maven artifacts
               archiveArtifacts 'target/*.war'
              // archiveArtifacts artifacts: 'target/*.war', followSymlinks: false
            }
        }
        
         stage('deploy') {
            steps {
            withCredentials([usernameColonPassword(credentialsId: 'tomcat-credentials', variable: 'linux_tomcat_credentials')]) {
            sh "curl -v -u ${linux_tomcat_credentials} -T  /var/lib/jenkins/workspace/dev/target/maven-web-application.war 'http://ec2-3-86-194-176.compute-1.amazonaws.com:8080/manager/text/deploy?path=/maven-web-application&update=true'"
             }
             
             
            }
            
        }
        
    }
}
